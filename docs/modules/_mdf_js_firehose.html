<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@mdf.js/firehose | @mdf.js</title><meta name="description" content="Documentation for @mdf.js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@mdf.js</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">@mdf.js</a></li><li><a href="_mdf_js_firehose.html">@mdf.js/firehose</a></li></ul><h1>Module @mdf.js/firehose</h1></div><section class="tsd-panel tsd-typography"><a id="md:mdfjsfirehose" class="tsd-anchor"></a><h1 class="tsd-anchor-link"><strong>@mdf.js/firehose</strong><a href="#md:mdfjsfirehose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://nodejs.org/en/" target="_blank" class="external"><img src="https://img.shields.io/static/v1?style=flat&amp;logo=node.js&amp;logoColor=green&amp;label=node&amp;message=%3E=20&amp;color=blue" alt="Node Version"></a>
<a href="https://www.typescriptlang.org/" target="_blank" class="external"><img src="https://img.shields.io/static/v1?style=flat&amp;logo=typescript&amp;label=Typescript&amp;message=5.4&amp;color=blue" alt="Typescript Version"></a>
<a href="https://snyk.io/package/npm/snyk" target="_blank" class="external"><img src="https://img.shields.io/static/v1?style=flat&amp;logo=snyk&amp;label=Vulnerabilities&amp;message=0&amp;color=300A98F" alt="Known Vulnerabilities"></a></p>
<!-- markdownlint-disable MD033 MD041 -->
<p align="center">
  <div style="text-align:center;background-image:radial-gradient(circle farthest-corner at 50% 50%, #104c60, #0c0c13);">
    <img src="https://assets.website-files.com/626a3ef32d23835d9b2e4532/6290ab1e2d3e0d922913a6e3_digitalizacion_ENG.svg"alt="netin"width="500">
  </div>
</p>
<h1 style="text-align:center;margin-bottom:0">Mytra Development Framework - @mdf.js/firehose</h1>
<h5 style="text-align:center;margin-top:0">Module designed to facilitate the creation of customized data streaming pipelines.</h5>
<!-- markdownlint-enable MD033 -->
<hr>
<a id="md:table-of-contents" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><strong>Table of contents</strong><a href="#md:table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="#md:mdfjsfirehose"><strong>@mdf.js/firehose</strong></a>
<ul>
<li><a href="#md:table-of-contents"><strong>Table of contents</strong></a></li>
<li><a href="#md:introduction"><strong>Introduction</strong></a></li>
<li><a href="#md:installation"><strong>Installation</strong></a></li>
<li><a href="#md:use"><strong>Use</strong></a>
<ul>
<li><a href="#md:typing-your-own-firehose"><strong>Typing your own firehose</strong></a></li>
<li><a href="#md:jobs"><strong>Jobs</strong></a></li>
<li><a href="#md:creating-a-plug"><strong>Creating a Plug</strong></a>
<ul>
<li><a href="#md:plugssourceflow"><strong>Plugs.Source.Flow</strong></a></li>
<li><a href="#md:plugssourcesequence"><strong>Plugs.Source.Sequence</strong></a></li>
<li><a href="#md:plugssourcecreditflow"><strong>Plugs.Source.CreditFlow</strong></a></li>
<li><a href="#md:plugssinktap"><strong>Plugs.Sink.Tap</strong></a></li>
<li><a href="#md:plugssinkjet"><strong>Plugs.Sink.Jet</strong></a></li>
</ul>
</li>
<li><a href="#md:creating-a-strategy"><strong>Creating a Strategy</strong></a></li>
<li><a href="#md:event-handling"><strong>Event Handling</strong></a></li>
<li><a href="#md:firehose-configuration-and-lifecycle"><strong>Firehose Configuration and Lifecycle</strong></a></li>
<li><a href="#md:metrics-and-health-checks"><strong>Metrics and Health Checks</strong></a></li>
</ul>
</li>
<li><a href="#md:license"><strong>License</strong></a></li>
</ul>
</li>
</ul>
<a id="md:introduction" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><strong>Introduction</strong><a href="#md:introduction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>@mdf.js/firehose</strong> is a robust module within the @mdf.js ecosystem, designed to create customized data streaming pipelines. It provides a versatile framework for constructing complex data processing workflows, enabling developers to define custom plugs and strategies for handling diverse data streams.</p>
<p>Before delving into the documentation, it’s essential to understand the core concepts within @mdf.js/firehose:</p>
<ul>
<li>
<p><strong>Plugs</strong>: Plugs act as the endpoints of data pipelines, responsible for receiving and sending data to or from the pipeline. They adapt the data stream to the requirements of source or destination systems, aligning with each system’s flow needs. Plugs can be categorized as inputs (<strong>Source</strong>) or outputs (<strong>Sink</strong>) and vary by flow conditions supported by the connecting systems:</p>
<ul>
<li><strong>Source</strong>:
<ul>
<li><strong>Flow</strong>: Plugs that allow continuous data entry; this flow can be paused or restarted based on the pipeline’s state. Typical for data streaming systems like message brokers.</li>
<li><strong>Sequence</strong>: Plugs that enable data entry in a sequential flow, where the pipeline requests data in specified quantities from the plug. Common for data storage systems such as databases.</li>
<li><strong>CreditFlow</strong>: Continuous flow plugs that require a credit system to receive data. Common in data streaming systems that necessitate authorization to continue receiving data.</li>
</ul>
</li>
<li><strong>Sink</strong>:
<ul>
<li><strong>Tap</strong>: Plugs that process data one unit at a time, meaning the pipeline calls the plug’s write method for a single data instance. Common in systems that do not support bulk operations.</li>
<li><strong>Jet</strong>: Plugs that handle data in batches, where the pipeline calls the plug’s write method with multiple data instances. Typical for systems enabling bulk processing.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Jobs</strong>: Jobs are instances that transport data and metadata through the pipeline. They manage the data flow between plugs, ensuring correct processing and pipeline state maintenance. Source plugs are notified when a job completes, allowing them to “acknowledge” data from the source system. Jobs can carry additional metadata or processing information, which plugs and strategies can utilize to make decisions or perform specific actions.</p>
</li>
<li>
<p><strong>Strategies</strong>: Strategies provide customizable, <code>type</code>-based functions that define how to transform job-carried data. Strategies can filter, transform, enrich, or aggregate data as required. They can be chained to build complex data processing workflows, allowing developers to create tailored data pipelines.</p>
</li>
</ul>
<p>This entire ecosystem leverages Node.js streams to build high-performance data processing pipelines capable of efficiently handling large volumes of data.</p>
<p><img src="../media/firehose-diagram.svg" alt="Firehose"></p>
<p>Other key features of <strong>@mdf.js/firehose</strong> include:</p>
<ul>
<li><strong>Error Handling</strong>: The module provides a robust error handling mechanism, allowing developers to define custom error handling strategies for different scenarios.</li>
<li><strong>Logging</strong>: The module supports logging, enabling developers to track the pipeline’s execution and performance.</li>
<li><strong>Metrics</strong>: The module provides metrics for monitoring pipeline performance, allowing developers to track data processing efficiency and identify bottlenecks. These metrics are offered in the Prometheus format, using the <code>prom-client</code> library.</li>
<li><strong>Multi-Threaded Processing</strong>: The module supports multi-threaded processing, allowing developers to leverage the full potential of multi-core processors thanks to the <strong>@mdf.js/service-registry</strong> module.</li>
<li><strong>Tooling</strong>: The module provides a set of tools to facilitate the creation of custom plugs and strategies, including a plug generator and a strategy generator. These plugs could be based on the <strong>@mdf.js</strong> providers.</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><strong>Installation</strong><a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@mdf.js/firehose</span>
</code><button type="button">Copy</button></pre>

<pre><code class="bash"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@mdf.js/firehose</span>
</code><button type="button">Copy</button></pre>

<a id="md:use" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><strong>Use</strong><a href="#md:use" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:typing-your-own-firehose" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Typing your own firehose</strong><a href="#md:typing-your-own-firehose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Firehose</code> class, along with the <code>Jobs</code>, <code>Plugs</code>, and <code>Strategies</code> classes, are generic classes that allow you to define the types of the data that will be processed by the pipeline. This is useful to ensure that the data is correctly typed throughout the pipeline.</p>
<p>There are four types that you can define in the <code>Firehose</code> class:</p>
<ul>
<li><code>Type</code> (<code>Type extends string = string</code>): Job type, used as a selector for strategies in job processing.</li>
<li><code>Data</code> (<code>Data = any</code>): Data type that will be processed by the pipeline.</li>
<li><code>CustomHeaders</code> (<code>CustomHeaders extends Record&lt;string, any&gt; = {}</code>): Custom headers, used to pass specific information for job processors.</li>
<li><code>CustomOptions</code> (<code>CustomOptions extends Record&lt;string, any&gt; = {}</code>): Custom options, used to pass specific information for job processors.</li>
</ul>
<p>For example, if you want to create a pipeline that processes data of type <code>MyData</code>, you can define the <code>Firehose</code> class as follows:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Firehose</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-5">MyJobType</span><span class="hl-1"> = </span><span class="hl-2">&#39;TypeOne&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;TypeTwo&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-5">MyJobDataType</span><span class="hl-1">&lt;</span><span class="hl-5">T</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">MyJobType</span><span class="hl-1">&gt; = </span><span class="hl-5">T</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-2">&#39;TypeOne&#39;</span><br/><span class="hl-1">  ? { </span><span class="hl-6">fieldOne</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> }</span><br/><span class="hl-1">  : </span><span class="hl-5">T</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-2">&#39;TypeTwo&#39;</span><br/><span class="hl-1">    ? { </span><span class="hl-6">fieldTwo</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1"> }</span><br/><span class="hl-1">    : </span><span class="hl-5">never</span><span class="hl-1">;</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-5">JobHeaders</span><span class="hl-1"> = { </span><span class="hl-6">headerOne</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> };</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-5">JobOptions</span><span class="hl-1"> = { </span><span class="hl-6">optionOne</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> };</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">myFirehose</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Firehose</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">, </span><span class="hl-5">MyJobDataType</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">&gt;, </span><span class="hl-5">JobHeaders</span><span class="hl-1">, </span><span class="hl-5">JobOptions</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;MyFirehose&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-6">sources:</span><span class="hl-1"> [</span><span class="hl-7">/* Your source plugs */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-6">sinks:</span><span class="hl-1"> [</span><span class="hl-7">/* Your sink plugs */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-6">strategies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">TypeOne:</span><span class="hl-1"> [</span><span class="hl-7">/* Your strategies for TypeOne */</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">TypeTwo:</span><span class="hl-1"> [</span><span class="hl-7">/* Your strategies for TypeTwo */</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:jobs" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Jobs</strong><a href="#md:jobs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>As previously mentioned, jobs are instances that transport data and metadata through the pipeline. They manage the data flow between plugs, ensuring correct processing and pipeline state maintenance. <code>Source</code> and <code>Sink</code> plugs do not use <code>Jobs</code> directly to avoid the need to create and manage them manually. Instead, they use the <code>JobRequest</code>, in the case of <code>Source</code> plugs, and the <code>JobObject</code>, in the case of <code>Sink</code> plugs.</p>
<p>Both of them can be typed using the <code>Firehose</code> class that we previously defined. The <code>JobRequest</code> and <code>JobObject</code> types are defined as follows:</p>
<ul>
<li><code>JobRequest</code> is an object that contains the data and metadata that the <code>Source</code> plug needs to create a job.</li>
</ul>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">JobRequest</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-5">Type</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1"> = </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">Data</span><span class="hl-1"> = </span><span class="hl-5">unknown</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">CustomHeaders</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">Record</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">any</span><span class="hl-1">&gt; = </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">AnyHeaders</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">CustomOptions</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">Record</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">any</span><span class="hl-1">&gt; = </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">AnyOptions</span><span class="hl-1">,</span><br/><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Job type identification, used to identify specific job handlers to be applied */</span><br/><span class="hl-1">  </span><span class="hl-6">type</span><span class="hl-1">?: </span><span class="hl-5">Type</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/** User job request identifier, defined by the user */</span><br/><span class="hl-1">  </span><span class="hl-6">jobUserId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/** Job payload */</span><br/><span class="hl-1">  </span><span class="hl-6">data</span><span class="hl-1">: </span><span class="hl-5">Data</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/** Job meta information, used to pass specific information for job processors */</span><br/><span class="hl-1">  </span><span class="hl-6">options</span><span class="hl-1">?: </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">Options</span><span class="hl-1">&lt;</span><span class="hl-5">CustomHeaders</span><span class="hl-1">, </span><span class="hl-5">CustomOptions</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>An example of a <code>JobRequest</code> could be:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">jobRequest</span><span class="hl-1">: </span><span class="hl-5">JobRequest</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">, </span><span class="hl-5">MyJobDataType</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">&gt;, </span><span class="hl-5">JobHeaders</span><span class="hl-1">, </span><span class="hl-5">JobOptions</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;TypeOne&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">jobUserId:</span><span class="hl-1"> </span><span class="hl-2">&#39;1234&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">data:</span><span class="hl-1"> { </span><span class="hl-6">fieldOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">options:</span><span class="hl-1"> { </span><span class="hl-6">headers:</span><span class="hl-1"> { </span><span class="hl-6">headerOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> }, </span><span class="hl-6">optionOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<ul>
<li><code>JobObject</code> is an object that contains the data and metadata that the <code>Sink</code> plug needs to process a job.</li>
</ul>
<pre><code class="typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">JobObject</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-5">Type</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1"> = </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">Data</span><span class="hl-1"> = </span><span class="hl-5">any</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">CustomHeaders</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">Record</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">any</span><span class="hl-1">&gt; = </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">AnyHeaders</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">CustomOptions</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">Record</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">any</span><span class="hl-1">&gt; = </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">AnyOptions</span><span class="hl-1">,</span><br/><span class="hl-1">&gt; </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">JobRequest</span><span class="hl-1">&lt;</span><span class="hl-5">Type</span><span class="hl-1">, </span><span class="hl-5">Data</span><span class="hl-1">, </span><span class="hl-5">CustomHeaders</span><span class="hl-1">, </span><span class="hl-5">CustomOptions</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Job type identification, used to identify specific job handlers to be applied */</span><br/><span class="hl-1">  </span><span class="hl-6">type</span><span class="hl-1">: </span><span class="hl-5">Type</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/** Unique job processing identification */</span><br/><span class="hl-1">  </span><span class="hl-6">uuid</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/**</span><br/><span class="hl-7">   * Unique user job request identification, generated by UUID V5 standard and based on jobUserId</span><br/><span class="hl-7">   */</span><br/><span class="hl-1">  </span><span class="hl-6">jobUserUUID</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">/** Job status */</span><br/><span class="hl-1">  </span><span class="hl-6">status</span><span class="hl-1">: </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>An example of a <code>JobObject</code> could be:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">jobObject</span><span class="hl-1">: </span><span class="hl-5">JobObject</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">, </span><span class="hl-5">MyJobDataType</span><span class="hl-1">&lt;</span><span class="hl-5">MyJobType</span><span class="hl-1">&gt;, </span><span class="hl-5">JobHeaders</span><span class="hl-1">, </span><span class="hl-5">JobOptions</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;TypeOne&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">uuid:</span><span class="hl-1"> </span><span class="hl-2">&#39;f47ac10b-58cc-4372-a567-0e02b2c3d479&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">jobUserId:</span><span class="hl-1"> </span><span class="hl-2">&#39;1234&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">jobUserUUID:</span><span class="hl-1"> </span><span class="hl-2">&#39;f47ac10b-58cc-4372-a567-0e02b2c3d479&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">data:</span><span class="hl-1"> { </span><span class="hl-6">fieldOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">options:</span><span class="hl-1"> { </span><span class="hl-6">headers:</span><span class="hl-1"> { </span><span class="hl-6">headerOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> }, </span><span class="hl-6">optionOne:</span><span class="hl-1"> </span><span class="hl-2">&#39;value&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;pending&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p>When the <code>Sink</code> plug completes processing a job (using the <code>single</code> method for <code>Tap</code> plugs or the <code>single</code>/<code>multi</code> methods for <code>Jet</code> plugs), the <code>Firehose</code> will notify the <code>Source</code> plug that the job has been processed by calling the method <code>postConsume</code> with the <code>jobUserId</code> as a parameter.</p>
</blockquote>
<a id="md:creating-a-plug" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Creating a Plug</strong><a href="#md:creating-a-plug" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The first step in building a data streaming pipeline is creating a plug. Plugs act as the endpoints of the pipeline, handling data input and output. To create a plug, you need to create your own class that implements the <code>Source</code> or <code>Sink</code> interface. All the <code>Source</code> and <code>Sink</code> interfaces extend the interface <code>Layer.App.Resource</code>, including some additional methods and events to handle the data flow.</p>
<ul>
<li>
<p><strong>Source</strong></p>
<ul>
<li><strong>Events</strong>:
<ul>
<li><code>data</code>: Event that is emitted when the plug has data to be processed. The emitted data is a <code>JobRequest</code> object.</li>
</ul>
</li>
<li><strong>Methods</strong>:
<ul>
<li><code>postConsume(jobId: string): Promise&lt;string | undefined&gt;</code>: Method that is called when the plug has processed a job. The parameter is the <code>jobUserId</code> of the processed job. This method must return a promise that resolves to the same <code>jobUserId</code> of the processed job or <code>undefined</code>. If <code>undefined</code> is resolved, the <code>Firehose</code> will understand that the job has not been found in the source plug due to an error. This is an important method to implement to ensure that the pipeline is working correctly by cleaning from the source (if needed) when the job has been processed.</li>
</ul>
</li>
<li><strong>Types of Source Plugs</strong>:
<ul>
<li><strong>Flow</strong>:
<ul>
<li><code>init(): void</code>: Method that is called when the plug is initialized and indicates that the plug can start emitting data.</li>
<li><code>pause(): void</code>: Method that is called when the plug is paused and indicates that the plug should stop emitting data.</li>
</ul>
</li>
<li><strong>Sequence</strong>:
<ul>
<li><code>ingestData(size: number): Promise&lt;JobRequest | JobRequest[]&gt;</code>: Method that is called when the plug needs to ingest data. The parameter is the quantity of data that the plug needs to ingest. This method must return a promise that resolves to a single <code>JobRequest</code> object or an array of <code>JobRequest</code> objects. It's not necessary to resolve the exact quantity of data requested, but the plug must resolve at least one <code>JobRequest</code> object. If the plug doesn't have more data to ingest, it must block the promise until it has more data to ingest.</li>
</ul>
</li>
<li><strong>CreditFlow</strong>:
<ul>
<li><code>addCredits(credits: number): Promise&lt;number&gt;</code>: Method that is called to add credits to the plug. The parameter is the quantity of credits to add. This method must return a promise that resolves when the credits have been added to the plug, returning the number of credits that the plug has. Each emitted data will consume one credit. If the plug doesn't have credits, it must wait until <code>addCredits</code> is called to emit more data.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Sink</strong></p>
<ul>
<li><strong>Methods</strong>:
<ul>
<li><strong>Tap</strong>:
<ul>
<li><code>single(job: JobObject): Promise&lt;void&gt;</code>: Method that is called to process a single job.</li>
</ul>
</li>
<li><strong>Jet</strong>:
<ul>
<li><code>single(job: JobObject): Promise&lt;void&gt;</code>: Method that is called to process a single job.</li>
<li><code>multi(jobs: JobObject[]): Promise&lt;void&gt;</code>: Method that is called to process multiple jobs.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>As a <code>Layer.App.Resource</code>, the <code>Plugs</code> should include health information in the <code>checks</code> and <code>status</code> properties. The <code>status</code> property should be <code>pass</code> if the plug is healthy and <code>fail</code> if the plug is not healthy. The <code>checks</code> property should include an array of checks that the plug must pass to be considered healthy. If you use the <code>@mdf.js</code> framework to create your plug, you can combine the provider health information with the plug health information.</p>
<a id="md:plugssourceflow" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><strong>Plugs.Source.Flow</strong><a href="#md:plugssourceflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Plugs</span><span class="hl-1">, </span><span class="hl-6">JobRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">EventEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;events&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Registry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;prom-client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Health</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Plugs.Source.Flow interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MySourcePlug</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">EventEmitter</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Plugs</span><span class="hl-1">.</span><span class="hl-5">Source</span><span class="hl-1">.</span><span class="hl-5">Flow</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Constructor */</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the firehose has processed a job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">postConsume</span><span class="hl-1">(</span><span class="hl-6">jobId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the plug is initialized and indicates that the plug can start emitting data */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the plug is paused and indicates that the plug should stop emitting data */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">pause</span><span class="hl-1">(): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Start the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider and clean the resources */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">close</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Prometheus registry to store the metrics of the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">metrics</span><span class="hl-1">(): </span><span class="hl-5">Registry</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health status */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">status</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health checks */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">checks</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Checks</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:plugssourcesequence" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><strong>Plugs.Source.Sequence</strong><a href="#md:plugssourcesequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Plugs</span><span class="hl-1">, </span><span class="hl-6">JobRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">EventEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;events&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Registry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;prom-client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Health</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Plugs.Source.Sequence interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MySourcePlug</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">EventEmitter</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Plugs</span><span class="hl-1">.</span><span class="hl-5">Source</span><span class="hl-1">.</span><span class="hl-5">Sequence</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Constructor */</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the firehose has processed a job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">postConsume</span><span class="hl-1">(</span><span class="hl-6">jobId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the plug needs to ingest data */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">ingestData</span><span class="hl-1">(</span><span class="hl-6">size</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">JobRequest</span><span class="hl-1"> | </span><span class="hl-5">JobRequest</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Start the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider and clean the resources */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">close</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Prometheus registry to store the metrics of the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">metrics</span><span class="hl-1">(): </span><span class="hl-5">Registry</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health status */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">status</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health checks */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">checks</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Checks</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:plugssourcecreditflow" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><strong>Plugs.Source.CreditFlow</strong><a href="#md:plugssourcecreditflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Plugs</span><span class="hl-1">, </span><span class="hl-6">JobRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">EventEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;events&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Registry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;prom-client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Health</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Plugs.Source.CreditFlow interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MySourcePlug</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">EventEmitter</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Plugs</span><span class="hl-1">.</span><span class="hl-5">Source</span><span class="hl-1">.</span><span class="hl-5">CreditFlow</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Constructor */</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called when the firehose has processed a job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">postConsume</span><span class="hl-1">(</span><span class="hl-6">jobId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called to add credits to the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">addCredits</span><span class="hl-1">(</span><span class="hl-6">credits</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Start the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider and clean the resources */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">close</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Prometheus registry to store the metrics of the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">metrics</span><span class="hl-1">(): </span><span class="hl-5">Registry</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health status */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">status</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health checks */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">checks</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Checks</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:plugssinktap" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><strong>Plugs.Sink.Tap</strong><a href="#md:plugssinktap" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Plugs</span><span class="hl-1">, </span><span class="hl-6">JobRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">EventEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;events&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Registry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;prom-client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Health</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Plugs.Sink.Tap interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MySinkPlug</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">EventEmitter</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Plugs</span><span class="hl-1">.</span><span class="hl-5">Sink</span><span class="hl-1">.</span><span class="hl-5">Tap</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Constructor */</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called to process a single job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">single</span><span class="hl-1">(</span><span class="hl-6">job</span><span class="hl-1">: </span><span class="hl-5">JobObject</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Start the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider and clean the resources */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">close</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Prometheus registry to store the metrics of the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">metrics</span><span class="hl-1">(): </span><span class="hl-5">Registry</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health status */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">status</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health checks */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">checks</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Checks</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:plugssinkjet" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><strong>Plugs.Sink.Jet</strong><a href="#md:plugssinkjet" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Plugs</span><span class="hl-1">, </span><span class="hl-6">JobRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">EventEmitter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;events&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Registry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;prom-client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Health</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Plugs.Sink.Jet interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MySinkPlug</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-5">EventEmitter</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Plugs</span><span class="hl-1">.</span><span class="hl-5">Sink</span><span class="hl-1">.</span><span class="hl-5">Jet</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Constructor */</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called to process a single job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">single</span><span class="hl-1">(</span><span class="hl-6">job</span><span class="hl-1">: </span><span class="hl-5">JobObject</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called to process multiple jobs */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-0">multi</span><span class="hl-1">(</span><span class="hl-6">jobs</span><span class="hl-1">: </span><span class="hl-5">JobObject</span><span class="hl-1">[]): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Start the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">stop</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Stop the plug and the underlying provider and clean the resources */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">close</span><span class="hl-1">(): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Prometheus registry to store the metrics of the plug */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">metrics</span><span class="hl-1">(): </span><span class="hl-5">Registry</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health status */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">status</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Status</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Plug health checks */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">checks</span><span class="hl-1">(): </span><span class="hl-5">Health</span><span class="hl-1">.</span><span class="hl-5">Checks</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Implementation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:creating-a-strategy" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Creating a Strategy</strong><a href="#md:creating-a-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Strategies provide customizable, <code>type</code>-based functions that define how to transform job-carried data. Strategies can filter, transform, enrich, or aggregate data as required. They can be chained to build complex data processing workflows, allowing developers to create tailored data pipelines.</p>
<p>To create a strategy, you need to create a class that implements the <code>Strategy</code> interface. The <code>Strategy</code> interface includes the following methods and properties:</p>
<ul>
<li><code>do(process: JobHandler): Promise&lt;JobHandler&gt;</code>: Method that is called to process a job. The parameter is the <code>JobHandler</code> to process. This method must return a promise that resolves to a <code>JobHandler</code> with the processed data.</li>
<li><code>name: string</code>: Strategy name, used to identify the strategy in the pipeline.</li>
</ul>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Jobs</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/** Class that implements the Strategy interface */</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-5">MyStrategy</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">Strategy</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">/** Strategy name */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">get</span><span class="hl-1"> </span><span class="hl-0">name</span><span class="hl-1">(): </span><span class="hl-5">string</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&#39;MyStrategy&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">/** Method that is called to process a job */</span><br/><span class="hl-1">  </span><span class="hl-4">public</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-0">do</span><span class="hl-1">(</span><span class="hl-6">process</span><span class="hl-1">: </span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">JobHandler</span><span class="hl-1">): </span><span class="hl-5">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Jobs</span><span class="hl-1">.</span><span class="hl-5">JobHandler</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Process the job</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">process</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:event-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Event Handling</strong><a href="#md:event-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Firehose</code> class extends <code>EventEmitter</code> and emits several events that you can listen to:</p>
<ul>
<li>
<p><code>error</code>: Emitted when the component detects an error.</p>
<pre><code class="typescript"><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, (</span><span class="hl-6">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;An error occurred:&#39;</span><span class="hl-1">, </span><span class="hl-6">error</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><code>status</code>: Emitted when the component's status changes.</p>
<pre><code class="typescript"><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;status&#39;</span><span class="hl-1">, (</span><span class="hl-6">status</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Firehose status:&#39;</span><span class="hl-1">, </span><span class="hl-6">status</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><code>job</code>: Emitted when a new job is received from a source.</p>
<pre><code class="typescript"><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;job&#39;</span><span class="hl-1">, (</span><span class="hl-6">job</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;New job received:&#39;</span><span class="hl-1">, </span><span class="hl-6">job</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><code>done</code>: Emitted when a job has ended, either due to completion or failure.</p>
<pre><code class="typescript"><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;done&#39;</span><span class="hl-1">, (</span><span class="hl-6">uuid</span><span class="hl-1">, </span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Job </span><span class="hl-4">${</span><span class="hl-6">uuid</span><span class="hl-4">}</span><span class="hl-2"> failed with error:`</span><span class="hl-1">, </span><span class="hl-6">error</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Job </span><span class="hl-4">${</span><span class="hl-6">uuid</span><span class="hl-4">}</span><span class="hl-2"> completed with result:`</span><span class="hl-1">, </span><span class="hl-6">result</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><code>hold</code>: Emitted when the engine is paused due to inactivity.</p>
<pre><code class="typescript"><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;hold&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&#39;Firehose is on hold due to inactivity.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
</ul>
<a id="md:firehose-configuration-and-lifecycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Firehose Configuration and Lifecycle</strong><a href="#md:firehose-configuration-and-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To instantiate a <code>Firehose</code>, you need to provide a name and options that include the sources, sinks, and optionally, strategies, retry options, buffer size, etc.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-6">Firehose</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mdf.js/firehose&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">firehose</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Firehose</span><span class="hl-1">(</span><span class="hl-2">&#39;MyFirehose&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-6">sources:</span><span class="hl-1"> [</span><span class="hl-7">/* Your source plugs */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-6">sinks:</span><span class="hl-1"> [</span><span class="hl-7">/* Your sink plugs */</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-6">strategies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">TypeOne:</span><span class="hl-1"> [</span><span class="hl-7">/* Strategies for TypeOne */</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">TypeTwo:</span><span class="hl-1"> [</span><span class="hl-7">/* Strategies for TypeTwo */</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">retryOptions:</span><span class="hl-1"> </span><span class="hl-7">/* Your retry options */</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">bufferSize:</span><span class="hl-1"> </span><span class="hl-9">100</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">atLeastOne:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">logger:</span><span class="hl-1"> </span><span class="hl-7">/* Your logger instance */</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">maxInactivityTime:</span><span class="hl-1"> </span><span class="hl-9">60000</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>To manage the lifecycle of the <code>Firehose</code>, you can use the following methods:</p>
<ul>
<li><code>start(): Promise&lt;void&gt;</code>: Starts the firehose, initializing all the sources and sinks, and begins processing jobs.</li>
<li><code>stop(): Promise&lt;void&gt;</code>: Stops the firehose, gracefully shutting down all the sources and sinks.</li>
<li><code>close(): Promise&lt;void&gt;</code>: Stops the firehose and cleans up all resources.</li>
<li><code>restart(): Promise&lt;void&gt;</code>: Restarts the firehose, re-initializing all components.</li>
</ul>
<p>Example:</p>
<pre><code class="typescript"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><span class="hl-7">// Firehose is now running</span><br/><br/><span class="hl-7">// Later, when you need to stop it</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:metrics-and-health-checks" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Metrics and Health Checks</strong><a href="#md:metrics-and-health-checks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>Firehose</code> class includes a Prometheus registry to store the metrics of the pipeline. As you can see in the previous examples, new metrics can be added to the plug classes. The <code>Firehose</code> instance will collect all the metrics of the plugs and will expose them in the <code>metrics</code> property of the <code>Firehose</code> instance.</p>
<p>The default metrics included in the <code>Firehose</code> instance are:</p>
<ul>
<li><code>api_all_job_processed_total</code>: The total number of all jobs processed, with the label <code>type</code>.</li>
<li><code>api_all_errors_job_processing_total</code>: The total number of errors processing jobs, with the label <code>type</code>.</li>
<li><code>api_all_job_in_processing_total</code>: Number of jobs currently processing (no response yet), with the label <code>type</code>.</li>
<li><code>api_publishing_job_duration_milliseconds</code>: Firehose jobs duration, with the label <code>type</code>.</li>
<li><code>api_publishing_throughput</code>: Firehose throughput in bytes, with the label <code>type</code>.</li>
</ul>
<p>On the other side, <code>Plugs</code> should include health information in the <code>checks</code> and <code>status</code> properties. This information will be grouped with the <code>Firehose</code> health information. The <code>status</code> property should be <code>pass</code> if all the checks are passing and <code>fail</code> if any check is failing.</p>
<p>The health information can be classified into two types: stream status (number of pending jobs in the pipeline) and recent plug operations.</p>
<p>You can access the health status and checks through the <code>status</code> and <code>checks</code> properties:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">firehoseStatus</span><span class="hl-1"> = </span><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">firehoseChecks</span><span class="hl-1"> = </span><span class="hl-6">firehose</span><span class="hl-1">.</span><span class="hl-6">checks</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><strong>License</strong><a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Copyright 2024 Mytra Control S.L. All rights reserved.</p>
<p>Use of this source code is governed by an MIT-style license that can be found in the LICENSE file or at <a href="https://opensource.org/licenses/MIT" target="_blank" class="external">https://opensource.org/licenses/MIT</a>.</p>
</section><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><h3 class="tsd-index-heading uppercase">Index</h3><section class="tsd-index-section"><h3 class="tsd-index-heading">Namespaces</h3><div class="tsd-index-list"><a href="_mdf_js_firehose.Plugs.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-4"></use></svg><span>Plugs</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Classes</h3><div class="tsd-index-list"><a href="../classes/_mdf_js_firehose.Firehose.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-128"></use></svg><span>Firehose</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Interfaces</h3><div class="tsd-index-list"><a href="../interfaces/_mdf_js_firehose.FirehoseOptions.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-256"></use></svg><span>Firehose<wbr/>Options</span></a>
<a href="../interfaces/_mdf_js_firehose.PostConsumeOptions.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-256"></use></svg><span>Post<wbr/>Consume<wbr/>Options</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Type Aliases</h3><div class="tsd-index-list"><a href="../types/_mdf_js_firehose.JobEventHandler.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Job<wbr/>Event<wbr/>Handler</span></a>
</div></section></section></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:mdfjsfirehose"><span>@mdf.js/firehose</span></a><ul><li><a href="#md:table-of-contents"><span>Table of contents</span></a></li><li><a href="#md:introduction"><span>Introduction</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:use"><span>Use</span></a></li><li><ul><li><a href="#md:typing-your-own-firehose"><span>Typing your own firehose</span></a></li><li><a href="#md:jobs"><span>Jobs</span></a></li><li><a href="#md:creating-a-plug"><span>Creating a <wbr/>Plug</span></a></li><li><ul><li><a href="#md:plugssourceflow"><span>Plugs.<wbr/>Source.<wbr/>Flow</span></a></li><li><a href="#md:plugssourcesequence"><span>Plugs.<wbr/>Source.<wbr/>Sequence</span></a></li><li><a href="#md:plugssourcecreditflow"><span>Plugs.<wbr/>Source.<wbr/>Credit<wbr/>Flow</span></a></li><li><a href="#md:plugssinktap"><span>Plugs.<wbr/>Sink.<wbr/>Tap</span></a></li><li><a href="#md:plugssinkjet"><span>Plugs.<wbr/>Sink.<wbr/>Jet</span></a></li></ul></li><li><a href="#md:creating-a-strategy"><span>Creating a <wbr/>Strategy</span></a></li><li><a href="#md:event-handling"><span>Event <wbr/>Handling</span></a></li><li><a href="#md:firehose-configuration-and-lifecycle"><span>Firehose <wbr/>Configuration and <wbr/>Lifecycle</span></a></li><li><a href="#md:metrics-and-health-checks"><span>Metrics and <wbr/>Health <wbr/>Checks</span></a></li></ul></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>@mdf.js</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
